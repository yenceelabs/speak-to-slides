name: Deploy to Vercel (Fallback)

on:
  push:
    branches: [main]
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Trigger Vercel Deploy Hook
        env:
          VERCEL_DEPLOY_HOOK: ${{ secrets.VERCEL_DEPLOY_HOOK }}
        run: |
          if [ -z "$VERCEL_DEPLOY_HOOK" ]; then
            echo "::warning::VERCEL_DEPLOY_HOOK secret not set. Skipping deploy trigger."
            exit 0
          fi
          echo "Triggering Vercel deploy..."
          HTTP_STATUS=$(curl -s -o /dev/null -w "%{http_code}" -X POST "$VERCEL_DEPLOY_HOOK")
          echo "Vercel responded with HTTP $HTTP_STATUS"
          if [ "$HTTP_STATUS" -ge 200 ] && [ "$HTTP_STATUS" -lt 300 ]; then
            echo "✅ Deploy triggered successfully"
          else
            echo "❌ Deploy trigger failed with HTTP $HTTP_STATUS"
            exit 1
          fi
